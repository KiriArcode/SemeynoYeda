# SemeynoYeda — Feature List & Roadmap

Дизайн-система: [STYLEGUIDE.md](STYLEGUIDE.md) | Словарь элементов: [DESIGN_DICTIONARY.md](DESIGN_DICTIONARY.md)

---

## Пользователи

- **Коля** — 36 лет, гастрит, лишний вес, работает из дома. Нужна щадящая еда (`gastritis-safe`). Днём может разогреть замороженное. Основные способы: пароварка, аэрогриль (без масла), тушение.
- **Кристина** — 34 года, лишний вес, работает в офисе. Утром кофе, на завтрак времени нет. Обед берёт с собой или покупает. Основные способы: духовка (корочка), электрогриль, сковорода.
- **Общее**: продукты закупаются раз в неделю. Раз в неделю — prep day (заготовки: фарш по пакетам, котлеты, фрикадельки, соусы). Рецепты находят в интернете и записывают. На первом этапе рецепты вводятся через Cursor + git push.

---

## Реализовано (фаза 0)

### Навигация и оболочка

- React Router с lazy-загрузкой страниц, basename для prod (`/SemeynoYeda`)
- PageShell: header «SemeynoYeda» + ChefModeToggle, main с `chef-mode`/`normal-mode`
- BottomNav: два набора пунктов (обычный и режим повара), активная полоска сверху
- Режим повара: переключатель с optimistic update (useCallback + functional setState), настройки в IndexedDB
- Хлебные крошки (Breadcrumbs): кнопка «Назад» + цепочка навигации на всех страницах
- Ссылки из MealSlot на страницу рецепта

### Страницы

| Маршрут | Страница | Что делает |
|---------|----------|------------|
| `/` | MenuPage | Недельное меню: карточки дней с MealSlot, создание из шаблона (с feedback «Готово!»), пустое состояние |
| `/recipes` | RecipesPage | Каталог 28 рецептов: поиск, фильтр по категориям, тег из query (`?tag=prep-day`), бейджи suitableFor и теги на карточках |
| `/recipe/:id` | RecipeDetailPage | Детали рецепта: теги, suitableFor, время, порции, оборудование, хранение (холодильник/морозилка), ингредиенты, пошаговое приготовление, заметки |
| `/shopping` | ShoppingPage | Список покупок: авто-генерация из меню, фильтры (все/авто/вручную/отсутствует), группировка по категориям, прогресс, регенерация из меню |
| `/freezer` | FreezerPage | Морозилка: список элементов, порции, сроки годности |
| `/prep` | PrepPage | Подготовка: выбор даты, план по ингредиентам, группы задач |
| `/cooking` | CookingPage | Готовка: выбор даты и приёма, запуск сессии, параллельные таймеры |
| `/settings/chef` | ChefSettingsPage | Настройки режима повара: toggle-и, время подготовки по умолчанию |

### Компоненты

- **MealSlot**: слот приёма пищи. Рецепты — кликабельные ссылки на детали. Вариации, бейджи «для кого», цветная полоска по профилю. Проверка ингредиентов.
- **Breadcrumbs**: кнопка «Назад» + хлебные крошки (Меню > Рецепты > Рецепт)
- **IngredientCheck**: проверка наличия ингредиентов (available/missing/unknown), кнопка «Добавить в список покупок»
- **CookingSession**: многошаговая сессия (check → cooking → complete), инструкции по шагам
- **ParallelCooking**: активные таймеры с пауза/стоп и прогресс-баром
- **PrepBlock / PrepTaskCard**: план подготовки ингредиентов, группы задач, чекбоксы
- **ShoppingSettings**: день покупок, авто-генерация списка, расчёт следующей покупки
- **Modal, Toast, ChefModeToggle**: UI-компоненты

### Данные и синхронизация

- Dexie (IndexedDB): таблицы `recipes`, `menus`, `freezer`, `shopping`, `prepPlans`, `cookingSessions`, `chefSettings`
- **syncSeedRecipes**: при каждом запуске `bulkPut` всех seed-рецептов и seed-меню (новые рецепты из git автоматически появляются)
- 28 seed-рецептов: соусы, котлеты, фрикадельки, суфле, пюре, крупы, завтраки, полдники
- Теги: `gastritis-safe`, `soft-texture`, `rich-feel`, `freezable`, `quick`, `prep-day`
- Разделение: Коля / Кристина / Оба — в рецептах (`suitableFor`) и в меню (`forWhom`)
- Кухонное оборудование: `stove`, `oven`, `air-grill`, `e-grill`, `steamer`, `blender`, `mixer`, `grinder`, `vacuum`, `bowls`

### Хуки

- `useShoppingList` — генерация и управление списком покупок
- `useIngredientAvailability` — отметки наличия ингредиентов
- `usePrepPlan` — план подготовки по рецептам и дате
- `useCookingTimers` — таймеры готовки (старт/пауза/стоп)
- `useToast` — уведомления

### Дизайн

- Система «Dimension Kitchen»: тёмная тема void, портальный зелёный (#39FF14), тёплые food-цвета
- Шрифты: Chakra Petch (заголовки), DM Sans (текст), JetBrains Mono (данные)
- Анимации: cardAppear, portalPulse, card-hover с translateY, fadeIn
- Цветные индикаторы профилей: зелёный (Коля), оранжевый (Кристина), фиолетовый (Оба)

---

## В разработке (фазы 1-2)

### Фаза 1 — PWA и CRUD рецептов

**PWA (offline-first)**:
- `vite-plugin-pwa` + Workbox Service Worker
- `manifest.json` с иконками (192, 512)
- App shell: Cache First (HTML, CSS, JS)
- Данные: Stale While Revalidate
- Установка на телефон как приложение

**CRUD рецептов**:
- `/recipe/new` — форма добавления рецепта (все поля + raw-заметка для обработки через Cursor)
- `/recipe/:id/edit` — редактирование рецепта
- Удаление рецепта с подтверждением
- Компоненты: `RecipeForm`, `IngredientList` (редактируемый)

**Замена блюда в меню**:
- Тап на MealSlot → модал `SwapModal` → выбрать другой рецепт из каталога
- Фильтр по `suitableFor` и `category` в модале

**Версионирование seed-данных**:
- Поле `version: number` в Recipe: seed перезаписывает только если seed.version > db.version

### Фаза 2 — Замороженные компоненты

**Проблема**: MealSlot ссылается на рецепт, но не знает, что блюдо собирается из замороженных компонентов. Список покупок не учитывает запасы в морозилке.

**Решение**:
- `FreezerItem` расширение: `portionsRemaining`, `portionsOriginal`, `batchId`
- `MealSlot.recipes[]` расширение: `usesFromFreezer?: { freezerItemId: string; portions: number }[]`
- UI: индикатор снежинки "из морозилки" в MealSlot
- Shopping list: вычитать ингредиенты, покрытые замороженными компонентами
- Freezer page: "осталось X порций", предупреждение "заканчивается"

**Инструкции разогрева по персоне**:

| Заготовка | Коля (щадяще) | Кристина (вкусно) |
|-----------|---------------|-------------------|
| Котлеты | Пароварка 25 мин / Аэрогриль 180°C 20 мин | Электрогриль 7+7 мин / Духовка 200°C 25 мин |
| Суфле | Пароварка 15 мин | Духовка 170°C 15 мин |
| Фрикадельки | Пароварка 20 мин | Духовка 190°C 20 мин |
| Пюре | Плита, разогрев 5 мин | Плита, разогрев 5 мин |
| Соус | Плита, разогрев 3 мин | Плита, разогрев 3 мин |

---

## Планируется (фазы 3-7)

### Фаза 3 — Prep Day (заготовки выходного дня)

Полная переработка PrepPage в "Заготовки выходного дня" — 4-часовой workflow:

- **Batch Cooking Plan**: на основе меню недели собрать список заготовок — все `freezable` рецепты, количество порций за неделю минус запасы в морозилке
- **Чеклист заготовок**: карточки с рецептом, количеством, прогрессом
- **Параллельные процессы**: визуальная шкала — пока варится пюре, формуем котлеты
- **Таймеры заготовок**: пошаговый чек-лист с привязкой к оборудованию
- **Кнопка "Заморожено"**: по завершении — автоматически создать FreezerItem с датой и количеством
- **Список покупок для prep day**: отдельная генерация только из freezable рецептов

Workflow: Час 1 (фарш: гриндер → миксер → формовка) → Час 2 (плита + духовка параллельно) → Час 3 (блендер: пюре и соусы) → Час 4 (порционирование → вакууматор → морозилка).

Новый хук `useBatchCooking`.

### Фаза 4 — UX для реального дня

- **Завтрак**: тег `overnight`, фильтр "быстрые завтраки (< 5 мин)", состояние "только кофе" в MealSlot
- **Обед Кристины**: тег `packable` (можно взять с собой), иконка в MealSlot
- **Разогрев для Коли**: если блюдо из морозилки — инструкция "разморозить + разогреть X мин" с учётом оборудования
- **Новые теги**: `overnight`, `packable`, `low-calorie`
- **Фильтр "Мои блюда"**: быстрый доступ к рациону конкретного члена семьи

### Фаза 5 — Умные подсказки и статистика

- "Заканчиваются котлеты в морозилке — запланировать prep day?"
- "Соусов хватит на 2 дня — добавить в заготовки?"
- "Кабачковый соус — срок годности через 3 дня"
- При планировании недели — подсвечивать, хватит ли запасов в морозилке
- **Статистика разнообразия**: "На этой неделе курица 4 раза из 7" — предупреждение о монотонности, баланс категорий

### Фаза 6 — Шаблоны и экспорт данных

- **Шаблоны недель**: сохранить удачную неделю как шаблон, загрузить шаблон при планировании
- **Сезонные шаблоны**: лето / зима
- **История меню**: архив прошлых недель
- **Экспорт JSON**: кнопка "Сохранить в Git" → генерация JSON-файлов → скачивание
- **GitHub API sync** (опционально): коммит изменений через Personal Access Token → автодеплой

### Фаза 7 — Продвинутые функции

- **AI-генерация меню**: подбор на основе остатков в морозилке, предпочтений, диет-тегов
- **Нутриенты**: базовый расчёт КБЖУ на порцию и на день
- **Фото блюд**: прикрепить фото к рецепту (PWA camera API), помогает визуально выбирать при замене
- **Шаринг**: QR-код для синхронизации второго пользователя
- **Telegram-бот**: уведомления "Достань котлеты!", список покупок в чат
- **Семейные профили**: настройка диет-тегов для каждого члена семьи на странице `/settings`
