# SemeynoYeda — Feature List & Roadmap

Дизайн-система: [STYLEGUIDE.md](STYLEGUIDE.md) | Словарь элементов: [DESIGN_DICTIONARY.md](DESIGN_DICTIONARY.md)

---

## Пользователи

- **Коля** — 36 лет, гастрит, лишний вес, работает из дома. Нужна щадящая еда (`gastritis-safe`). Днём может разогреть замороженное.
- **Кристина** — 34 года, лишний вес, работает в офисе. Утром кофе, на завтрак времени нет. Обед берёт с собой или покупает.
- **Общее**: продукты закупаются раз в неделю. Раз в неделю — prep day (заготовки: фарш по пакетам, котлеты, фрикадельки, соусы). Рецепты находят в интернете и записывают. На первом этапе рецепты вводятся через Cursor + git push.

---

## Реализовано (фаза 0)

### Навигация и оболочка

- React Router с lazy-загрузкой страниц, basename для prod (`/SemeynoYeda`)
- PageShell: header «SemeynoYeda» + ChefModeToggle, main с `chef-mode`/`normal-mode`
- BottomNav: два набора пунктов (обычный и режим повара), активная полоска сверху
- Режим повара: переключатель с optimistic update, настройки в IndexedDB, `ChefModeContext`

### Страницы

| Маршрут | Страница | Что делает |
|---------|----------|------------|
| `/` | MenuPage | Недельное меню: карточки дней с MealSlot, создание из шаблона, пустое состояние |
| `/recipes` | RecipesPage | Каталог 28 рецептов: поиск, фильтр по категориям, тег из query (`?tag=prep-day`) |
| `/recipe/:id` | RecipeDetailPage | Детали рецепта: мета, ингредиенты, пошаговое приготовление, заметки |
| `/shopping` | ShoppingPage | Список покупок: авто-генерация из меню, фильтры, группировка по категориям, прогресс |
| `/freezer` | FreezerPage | Морозилка: список элементов, порции, сроки годности |
| `/prep` | PrepPage | Подготовка: выбор даты, план по ингредиентам, группы задач |
| `/cooking` | CookingPage | Готовка: выбор даты и приёма, запуск сессии, параллельные таймеры |
| `/settings/chef` | ChefSettingsPage | Настройки режима повара: toggle-и, время подготовки по умолчанию |

### Компоненты

- **MealSlot**: слот приёма пищи (завтрак/обед/полдник/ужин). Рецепты, вариации, бейджи «для кого», загрузка/ошибка. Цветная полоска слева по профилю. Проверка ингредиентов.
- **IngredientCheck**: проверка наличия ингредиентов (available/missing/unknown), кнопка «Добавить в список покупок»
- **CookingSession**: многошаговая сессия (check -> cooking -> complete), инструкции по шагам
- **ParallelCooking**: активные таймеры с пауза/стоп и прогресс-баром
- **PrepBlock / PrepTaskCard**: план подготовки ингредиентов, группы задач, чекбоксы
- **ShoppingSettings**: день покупок, авто-генерация списка, расчёт следующей покупки
- **Modal, Toast, ChefModeToggle**: UI-компоненты

### Данные

- Dexie (IndexedDB): таблицы `recipes`, `menus`, `freezer`, `shopping`, `prepPlans`, `cookingSessions`, `chefSettings`
- 28 seed-рецептов: соусы, котлеты, фрикадельки, суфле, пюре, крупы, завтраки, полдники
- Теги: `gastritis-safe`, `soft-texture`, `rich-feel`, `freezable`, `quick`, `prep-day`
- Разделение: Коля / Кристина / Оба — в рецептах (`suitableFor`) и в меню (`forWhom`)

### Хуки

- `useShoppingList` — генерация и управление списком покупок
- `useIngredientAvailability` — отметки наличия ингредиентов
- `usePrepPlan` — план подготовки по рецептам и дате
- `useCookingTimers` — таймеры готовки (старт/пауза/стоп)
- `useToast` — уведомления

### Дизайн

- Система «Dimension Kitchen»: тёмная тема void, портальный зелёный (#39FF14), тёплые food-цвета
- Шрифты: Chakra Petch (заголовки), DM Sans (текст), JetBrains Mono (данные)
- Анимации: cardAppear, portalPulse, card-hover с translateY
- Цветные индикаторы профилей: зелёный (Коля), оранжевый (Кристина), фиолетовый (Оба)

---

## В разработке (фазы 1-2)

### Фаза 1 — Синхронизация рецептов из git

**Проблема**: seed-рецепты загружаются только в пустую БД. Новые рецепты, добавленные через Cursor + git push в `seedRecipes.ts`, не появляются после первого запуска.

**Решение**:
- `syncSeedRecipes()` — при каждом запуске upsert рецептов по `id`
- Поле `version: number` в Recipe: seed перезаписывает только если seed.version > db.version
- Аналогичная синхронизация для seed-меню

**Файлы**: `src/lib/initDb.ts`, `src/data/schema.ts`

### Фаза 2 — Замороженные компоненты

**Проблема**: MealSlot ссылается на рецепт, но не знает, что блюдо собирается из замороженных компонентов (котлеты из морозилки + свежее пюре + соус из морозилки). Список покупок не учитывает запасы в морозилке.

**Решение**:
- `FreezerItem` расширение: `portionsRemaining`, `portionsOriginal`, `batchId`
- `MealSlot.recipes[]` расширение: `usesFromFreezer?: { freezerItemId: string; portions: number }[]`
- UI: индикатор снежинки "из морозилки" в MealSlot
- Shopping list: вычитать ингредиенты, покрытые замороженными компонентами
- Freezer page: "осталось X порций", предупреждение "заканчивается"

**Файлы**: `src/data/schema.ts`, `src/components/menu/MealSlot.tsx`, `src/pages/FreezerPage.tsx`, `src/hooks/useShoppingList.ts`

---

## Планируется (фазы 3-5)

### Фаза 3 — Prep Day (заготовки выходного дня)

Полная переработка PrepPage в "Заготовки выходного дня":

- **Batch Cooking Plan**: на основе меню недели собрать список заготовок — все `freezable` рецепты, количество порций за неделю минус запасы в морозилке
- **Чеклист заготовок**: карточки с рецептом, количеством, прогрессом
- **Кнопка "Заморожено"**: по завершении — автоматически создать FreezerItem
- **Список покупок для prep day**: отдельная генерация только из freezable рецептов

Новый хук `useBatchCooking`.

### Фаза 4 — UX для реального дня

- **Завтрак**: тег `overnight`, фильтр "быстрые завтраки (< 5 мин)", состояние "только кофе" в MealSlot
- **Обед Кристины**: тег `packable` (можно взять с собой), иконка в MealSlot
- **Разогрев для Коли**: если блюдо из морозилки — инструкция "разморозить + разогреть X мин"
- **Новые теги**: `overnight`, `packable`, `low-calorie`

### Фаза 5 — Умные подсказки

- "Заканчиваются котлеты в морозилке — запланировать prep day?"
- "Соусов хватит на 2 дня — добавить в заготовки?"
- "Кабачковый соус — срок годности через 3 дня"
- При планировании недели — подсвечивать, хватит ли запасов в морозилке
