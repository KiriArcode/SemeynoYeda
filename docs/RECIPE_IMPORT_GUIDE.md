# Руководство по импорту рецептов из JSON

Это руководство описывает процесс импорта рецептов в базу данных через JSON файл с использованием компонента импорта в приложении.

## Доступ к импорту

1. Откройте страницу со списком рецептов (`/recipes`)
2. Нажмите кнопку **"Импорт рецептов"** в верхней части страницы
3. Откроется модальное окно для импорта

## Формат JSON файла

### Один рецепт

```json
{
  "id": "seed-kabachkovyj-sous",
  "slug": "kabachkovyj-sous",
  "title": "Кабачковый соус",
  "subtitle": "база для Коли",
  "category": "sauce",
  "tags": ["gastritis-safe", "freezable"],
  "suitableFor": "both",
  "prepTime": 10,
  "cookTime": 20,
  "totalTime": 30,
  "servings": 4,
  "ingredients": [
    { "name": "кабачок", "amount": 500, "unit": "г" },
    { "name": "лук", "amount": 1, "unit": "шт" }
  ],
  "steps": [
    {
      "order": 1,
      "text": "Кабачок нарезать кубиками",
      "duration": 5
    },
    {
      "order": 2,
      "text": "Варить на среднем огне 15 минут",
      "duration": 15,
      "equipment": {
        "id": "stove",
        "label": "Газовая плита",
        "settings": "средний огонь",
        "duration": 15
      }
    }
  ],
  "equipment": ["stove", "blender"],
  "storage": {
    "fridge": 3,
    "freezer": 2,
    "vacuumSealed": false
  },
  "reheating": [
    {
      "forWhom": "kolya",
      "method": "Пароварка 20 мин",
      "equipment": "steamer",
      "duration": 20
    }
  ],
  "notes": "Можно использовать как основу для других блюд"
}
```

### Массовый импорт (массив рецептов)

```json
[
  {
    "id": "seed-recipe-1",
    "slug": "recipe-1",
    "title": "Рецепт 1",
    ...
  },
  {
    "id": "seed-recipe-2",
    "slug": "recipe-2",
    "title": "Рецепт 2",
    ...
  }
]
```

## Обязательные поля

- `id` - уникальный идентификатор (например, `seed-<slug>`)
- `slug` - url-friendly имя (латиница, дефисы вместо пробелов)
- `title` - название рецепта
- `category` - категория: `main`, `sauce`, `side`, `breakfast`, `snack`, `soup`, `dessert`
- `tags` - массив тегов (может быть пустым `[]`)
- `suitableFor` - для кого: `kolya`, `kristina`, `both`
- `prepTime` - время подготовки в минутах
- `cookTime` - время готовки в минутах
- `totalTime` - общее время (обычно `prepTime + cookTime`)
- `servings` - количество порций
- `ingredients` - массив ингредиентов
- `steps` - массив шагов приготовления
- `equipment` - массив используемого оборудования
- `storage` - объект с информацией о хранении

## Опциональные поля

- `subtitle` - подзаголовок
- `notes` - заметки и советы
- `source` - источник рецепта
- `imageUrl` - URL изображения
- `reheating` - инструкции по разогреву (рекомендуется для замороженных блюд)
- `version` - версия рецепта (для синхронизации)

**Примечание**: Поля `createdAt`, `updatedAt`, `wabbaRatings`, `excludedFromMenu` генерируются автоматически и не должны быть в JSON.

## Процесс импорта

1. **Загрузка файла**: Перетащите JSON файл в область загрузки или выберите файл через кнопку
2. **Валидация**: Система проверяет структуру JSON и формат данных
3. **Проверка дубликатов**: Для каждого рецепта проверяется наличие дубликатов по `title` или `slug`
4. **Предпросмотр**: Отображается список рецептов для импорта с возможностью исключения дубликатов
5. **Импорт**: Нажмите "Импортировать" для добавления рецептов в базу данных
6. **Результаты**: Отображается количество успешно импортированных рецептов и список ошибок (если есть)

## Проверка дубликатов

Рецепт считается дубликатом, если:
- Его `title` точно совпадает с существующим рецептом **ИЛИ**
- Его `slug` точно совпадает с существующим рецептом

При обнаружении дубликата:
- Рецепт отображается в списке с пометкой "Дубликат"
- По умолчанию дубликаты исключаются из импорта
- Вы можете вручную включить дубликат, если хотите обновить существующий рецепт

## Обработка ошибок

### Ошибки валидации

Если JSON файл содержит ошибки:
- Неправильная структура данных
- Отсутствуют обязательные поля
- Неверные значения enum (category, tags, suitableFor и т.д.)

Система покажет список ошибок с указанием проблемных рецептов и полей.

### Ошибки при импорте

Если импорт частично не удался:
- Отображается количество успешно импортированных рецептов
- Показывается список рецептов, которые не удалось импортировать
- Указывается причина ошибки для каждого рецепта

## Примеры использования

### Пример 1: Импорт одного рецепта

Создайте файл `recipe.json`:

```json
{
  "id": "seed-new-recipe",
  "slug": "new-recipe",
  "title": "Новый рецепт",
  "category": "main",
  "tags": ["quick"],
  "suitableFor": "both",
  "prepTime": 5,
  "cookTime": 10,
  "totalTime": 15,
  "servings": 2,
  "ingredients": [
    { "name": "ингредиент", "amount": 200, "unit": "г" }
  ],
  "steps": [
    {
      "order": 1,
      "text": "Описание шага",
      "duration": 10
    }
  ],
  "equipment": ["stove"],
  "storage": {}
}
```

Загрузите файл через компонент импорта.

### Пример 2: Массовый импорт из AI генератора

1. Соберите список названий рецептов
2. Используйте промпт из [recipe-data-templates.md](./recipe-data-templates.md) в AI инструменте (Gemini/Claude)
3. Скопируйте сгенерированный JSON массив рецептов
4. Сохраните в файл `.json`
5. Импортируйте через компонент импорта

## Рекомендации

1. **Проверка перед импортом**: Убедитесь, что все обязательные поля заполнены
2. **Уникальные ID**: Используйте уникальные `id` для каждого рецепта (например, `seed-<slug>`)
3. **Правильные slug**: Slug должен быть url-friendly (латиница, дефисы, без пробелов)
4. **Время приготовления**: Убедитесь, что `totalTime = prepTime + cookTime`
5. **Заморозка**: Для замороженных блюд обязательно добавьте `reheating` инструкции
6. **Компоненты**: Если ингредиент является другим рецептом (например, "Кабачковый соус"), система автоматически обнаружит это и создаст ссылку

## Связанные документы

- [recipe-data-templates.md](./recipe-data-templates.md) - шаблоны данных и промпт для AI
- [RECIPE_STRUCTURE.md](./RECIPE_STRUCTURE.md) - полная структура рецепта
- [SEED_NEON_GUIDE.md](./SEED_NEON_GUIDE.md) - загрузка seed данных в Neon
